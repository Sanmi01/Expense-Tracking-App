<%- include('../includes/head.ejs') %>
</head>

<body>
    <%- include('../includes/navigation.ejs') %>

    
<div class="col-sm-12 single">
    <h1><%= title %></h1>
    <h3>Details of a Single Type</h3>
    <p>Type ID = <%= type.id %></p>
    <p>Name: <%= type.name %></p>
    <a href="/type/<%= type.id %>/update">Edit type</a> | <a href="/type/<%= type.id %>/delete">Delete type</a>
</div>

<% if(type.Expenses.length == 0) { %>
    <h2>There are no expenses made under this type yet </h2>
<% } else { %>
    <h2>Expenses Made: <%= type.Expenses.length %> </h2>
    <div>
        <% type.Expenses.forEach(function(expense) { %>
            <div class="details">
          <div>
            <p><%= expense.name %></p>
            <p>Amount: $<%= expense.amount %></p>
          </div>
          <% if (expense.status == 'Pending') { %>
            <p>Status: <%= expense.status %></p>
            <button class="review-expense-button">Review Expense</button><br>
            <a href="/expense/<%= expense.id %>" >View Expense</a> | <a href="/expense/<%= expense.id %>/update">Edit expense</a> | <a href="/expense/<%= expense.id %>/delete">Delete expense</a>
            <div class="modal-container modal">
                <div class="modal">
                    <button class="close-btn close">
                        <i class="fa fa-times"></i>
                    </button>
                    <div>
                        <h2>Review Expense</h2>
                        <p>Name: <%= expense.name %></p>
                        <p>Details: <%= expense.details %></p>
                        <p>Amount: $<%= expense.amount %></p>
                    </div>
            <form action="/expense/<%= expense.id %>/review" method="post" class="toggle" id="review-expense-form">
                Manager:
                    <select name = "employee_id" class="form-control" required>
                        <% employees.forEach(function(employee) { %>
                            <% if((employee.role.toLowerCase()) == 'manager' && employee.DepartmentId == expense.DepartmentId){ %>  
                                <option  value="<%= employee.id %>"><%= employee.first_name %></option>
                                <% } %>
                        <br/>
                        <% }); %>
                    </select>
                    <br>
                    Status:
                    <select name = "status">
                        <option value="Approved">Approved</option>
                        <option  value="Declined">Declined</option>
                    </select><br>
                    <input type="submit" value="Submit">
            </form>
            </div>
            </div>
            </div>
            <% } else { %>
                <p>Status: <%= expense.status %></p>
                <a href="/expense/<%= expense.id %>" >View Expense</a> | <a href="/expense/<%= expense.id %>/delete">Delete expense</a>
            </div>
                <% } %>
        <% }); %>
      </div>
 <% } %>
</div>

<a href="type/create"><button>Add type</button></a>

<%- include('../includes/end.ejs') %>