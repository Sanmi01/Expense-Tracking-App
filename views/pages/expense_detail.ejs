<%- include('../includes/head.ejs') %>
</head>

<body>
    <%- include('../includes/navigation.ejs') %>

    
<div class="col-sm-12 single">
    <h1><%= title %></h1>
    <h3>Details of a Single Expense</h3>
    <p>Expense ID = <%= expense.id %></p>
    <p>Name: <%= expense.name %></p>
    <p>Details: <%= expense.details %></p>
    <p>Amount: $<%= expense.amount %></p>
    <p>Type: <%= expense.Type.name %></p>
    <p>Category: <%= expense.Category.name %></p>
    <p>Time Created: <%= expense.time %></p>
    <p>Expense Made By: <%= expense.Employee.first_name %> <%= expense.Employee.last_name %> (<%= expense.Employee.role %>)</p>
    <p>Expense Made From: <%= expense.Department.name %></p>
    <% if (expense.status == 'Pending') { %>
        <p>Status: <%= expense.status %></p>
        <button class="review-expense-button">Review Expense</button><br>
        <a href="/expense/<%= expense.id %>/update">Edit expense</a> | <a href="/expense/<%= expense.id %>/delete">Delete expense</a>
        <div class="modal-container modal">
            <div class="modal">
                <button class="close-btn close">
                    <i class="fa fa-times"></i>
                </button>
                <h2>Review Expense</h2>
                <div>
                    <p>Name: <%= expense.name %></p>
                    <p>Details: <%= expense.details %></p>
                    <p>Amount: $<%= expense.amount %></p>
                </div>
        <form action="/expense/<%= expense.id %>/review" method="post" class="toggle" id="review-expense-form">
            Manager:
                <select name = "employee_id" class="form-control" required>
                    <% employees.forEach(function(employee) { %>
                        <% if((employee.role.toLowerCase()) == 'manager' && employee.DepartmentId == expense.DepartmentId){ %>  
                            <option  value="<%= employee.id %>"><%= employee.first_name %></option>
                            <% } %>
                    <br/>
                    <% }); %>
                </select>
                <br>
                Status:
                <select name = "status">
                    <option value="Approved">Approved</option>
                    <option  value="Declined">Declined</option>
                </select><br>
                <input type="submit" value="Submit">
        </form>
        </div>
        </div>
        <% } else { %>
            <p>Status: <%= expense.status %></p>
            <a href="/expense/<%= expense.id %>/delete">Delete expense</a>
        <% } %>
    
</div>
</div>


<%- include('../includes/end.ejs') %>